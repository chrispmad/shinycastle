<!DOCTYPE html>
<html lang="en">
<head>
    <link href="shinycastle/styles-auth.css" rel="stylesheet">
    <link href="shinycastle/styles-castle.css" rel="stylesheet">
    <link href="shinycastle/castle-dimension-styles.css" rel="stylesheet">
    <script src = "shinycastle/bindEnter.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>

    function PlayMusic() {
        var play=document.getElementById("music");
        play.play();
    }

    function StopMusic() {
      var play=document.getElementById("music");
      play.pause();
    }

    $(document).ready(function(){

        // Bind the button to authenticate to the enter key (I think?)
        bindEnter('auth-');

        gate_open = 0;

        //gate = document.getElementById('gate');
        music_box = document.getElementById('music_box');
        sun_moon = document.getElementById('sun_or_moon');
        sky = document.getElementById('sky');
        gate = document.getElementById('auth-go_auth');
        dragon = document.getElementById('red_dragon');

        var music_is_playing = false;
        lute_clicked = false;

        setInterval(function() {
          if(music_is_playing == false & lute_clicked == false){
            PlayMusic();
            music_is_playing = true;
          }
        }, 1000);

        // Click effects
        music_box.addEventListener('click', function() {
            if(!music_is_playing){
                PlayMusic();
                music_is_playing = true;
            } else {
                StopMusic();
                music_is_playing = false;
                lute_clicked = true;
            }
        });

        //gate.addEventListener('click', function() {
        //  gate.classList.add('gate-down');
        //});
    })
</script>
</head>
<body>

<div id="auth-auth-mod" class="panel-auth" style = "overflow: hidden;">
<div class = 'container'>
    <div class = "sky" id = "sky"></div>
    <div class = 'solarflare'></div>
    <div class = 'sun' id = 'sun' style = 'left: 80%; top: 5%;'></div>
    <div class = 'moon' id = 'moon' style = 'left: 20%; top: 75%;'></div>
    <div class = 'firmament'>
      <div class = 'star' style = 'top: 2%; left: 5%;'></div>
      <div class = 'star' style = 'top: 10%; left: 20%;'></div>
      <div class = 'star' style = 'top: 12%; left: 40%;'></div>
      <div class = 'star' style = 'top: 32%; left: 8%;'></div>
      <div class = 'star' style = 'top: 18%; left: 17%;'></div>
      <div class = 'star' style = 'top: 16%; left: 80%;'></div>
      <div class = 'star' style = 'top: 8%; left: 82%;'></div>
    </div>
    <div class = 'cloud cloud1'></div>
    <div class = 'cloud cloud2'></div>
    <div class = 'cloud cloud3'></div>
    <div class = 'bird' style = 'left:130%; top:3%;'>
      <div class = 'bird-wings'>UU</div>
    </div>
    <div class = 'bird' style = 'left:126%; top:2.5%;'>
        <div class = 'bird-wings'>UU</div>
      </div>
      <div class = 'bird' style = 'left:131%; top:4%;'>
        <div class = 'bird-wings'>UU</div>
      </div>
    <div class = 'bird' style = 'left:100%; top:6%;'>
      <div class = 'bird-wings'>UU</div>
    </div>
    <div class = 'bird' style = 'left:160%; top:3%;'>
      <div class = 'bird-wings'>UU</div>
    </div>
    <div class = 'dragon' id = 'red_dragon' style = 'left:-20%; top: 5%;'></div>
    <div class = 'mountains'></div>
    <div class = 'grass'></div>
    <div class = 'forest' style = 'position: absolute;
  top:60%;
  left:0%;
  width:100%;
  height:100%;'>
      <div class = 'tree1' style = 'top: -10%; left: 80%; width: 35%; height: 35%; z-index: 105;'></div>
      <div class = 'tree2' style = 'top: 0%; left: 76%; width: 32%; height: 32%; z-index: 105;'></div>
      <div class = 'tree2' style = 'top: 0%; left: 0%;'></div>
      <div class = 'tree2' style = 'top: 10%; left: 25%;'></div>
      <div class = 'tree1' style = 'top: -20%; left: 5%;'></div>
      <div class = 'tree1' style = 'top: -21%; left: 89%;'></div>
    </div>
    <div id = 'music_box' class = "lute"></div>
    <div class = 'moat'>
        <div class = 'wave' style = 'left:27.5%; top:85%'></div>
        <div class = 'wave wave-delay' style = 'left:30%'></div>
        <div class = 'wave wave-delay' style = 'left:60%'></div>
        <div class = 'wave' style = 'left:70%; top:75%'></div>
    </div>
    <div class = "castle" id = 'castle'>
        <div class="tower left">
          <div class = 'pixel-guard' id = 'pixel-guard-1'></div>
          <div class = "crenellation cren-left"></div>
        </div>
        <div class="tower right">
            <div class = 'pixel-guard' id = 'pixel-guard-2'></div>
            <div class = "crenellation cren-right"></div>
        </div>
        <div class="castle-gate">
          <div class = "cloth-banner">
            <div class="row">
              <div class="col-sm-6 offset-md-2 col-sm-offset-2">
                <div class="panel panel-primary panel-in-wall">
                  <div class="panel-body" style = "padding:5%;">
                    <div style="display:none">
                      <div class="row">
                        <div class="col-sm-4 offset-md-4 col-sm-offset-4">
                          <div id="auth-label_language" class="shiny-html-output"></div>
                        </div>
                        <div class="col-sm-6" style = "padding-left:2%;padding-right:2%;">
                          <div style="text-align: left;">
                            <div class="form-group shiny-input-container" style="width:100%;">
                              <label class="control-label shiny-label-null" for="auth-language" id="auth-language-label"></label>
                              <div>
                                <select id="auth-language" class="shiny-input-select"><option value="en" selected>English</option></select>
                                <script type="application/json" data-for="auth-language" data-nonempty="">{"plugins":["selectize-plugin-a11y"]}</script>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class = "med-text" style="text-align: center; margin-bottom:-2rem; z-index: 300;">
                      <h3 id="auth-shinymanager-auth-head" style = "font-size:20px;">Please Authenticate</h3>
                    </div>
                    <br/>
                    <div class = "row" style = "margin-left:-2%; margin-right:-2%;">
                      <div class="col-sm-6" style = "padding-left:2%;padding-right:2%;">
                        <div class="form-group shiny-input-container" style="width:100%; z-index: 300;">
                          <label class="med-text control-label" id="auth-user_id-label" for="auth-user_id">Username :</label>
                          <input id="auth-user_id" type="text" class="shiny-input-text form-control" value=""/>
                        </div>
                      </div>
                      <div class="col-sm-6"  style = "padding-left:2%;padding-right:2%;">
                        <div class="form-group shiny-input-container" style="width:100%; z-index: 300;">
                          <label class="med-text control-label" id="auth-user_pwd-label" for="auth-user_pwd">Password :</label>
                          <input id="auth-user_pwd" type="password" class="shiny-input-password form-control" value=""/>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
    </div>
          </div>
          <div class = 'gate-hole'>
                <!--<div class="gate" id = 'gate'>-->
                  <div id="auth-container-btn-ok" style = "transition: transform 2s ease; transform-origin: bottom;">
                      <button class="btn btn-default action-button med-text gate" id="auth-go_auth" type="button" style = "width:100%;">Enter</button>
                    <!--</div>-->
                    <div id="auth-result_auth"></div>
                    <div id="auth-update_shinymanager_language" class="shiny-html-output"></div>
                </div>
            </div>
        </div>
    </div>
    <div class = 'night-screen'></div>
    <audio id = "music">
    <source src = "https://cdn.uppbeat.io/audio-files/0e5573c69208594d8a7e799df2ff2bcc/396ec6405ec28210ded6fd46cc959dd1/b8e8d420316541b5a2353493561a5f5c/STREAMING-feast-days-simon-folwar-main-version-29943-02-25.mp3" type = "audio/mpeg">
    </audio>
    <audio id = 'dragon_firebreath_noise'>
      <source src = "https://cdn.freesound.org/previews/423/423009_3325582-lq.ogg" type = "audio/ogg">
    </audio>
</div>
<script>
  dragon = document.getElementById('red_dragon');
  guard_1 = document.getElementById('pixel-guard-1');
  guard_2 = document.getElementById('pixel-guard-2');
  dragon_firebreath_noise = document.getElementById('dragon_firebreath_noise');

  function createFireball() {
            const fireball = document.createElement('div');
            fireball.classList.add('fireball');
            fireball.id = 'fireball';
            fireball.style.top = '20%';
            fireball.style.left = '100%'; // Adjust the initial position as needed
            dragon.appendChild(fireball);
  }

  function dragon_flight() {
      let i = 1;
      // Get initial dragon position.
      // drag_pos_i = parseFloat(dragon.style.left);
      drag_pos_i = -20;
      // Define movement animation
      const interval = setInterval(function() {
          if(i < 101){
            // First bit: flying in from left of screen
          if (i <= 30) {
            if(i == 1){
              guard_1.classList.add('scared');
              guard_2.classList.add('scared');
            }
            if(i == 10){
              dragon_firebreath_noise.play();
            }
            const x_movement = i*1.5;
              dragon.style.left = drag_pos_i + x_movement + '%';
              i++;
          } else {
              // Fire-breathing pause
              if(i > 30 & i <= 45){
                  if(i == 31){
                      createFireball();
                      add_burn_marks();
                  }
              i++;
          } else {
            // Dragon flies to the right, off-screen.
              if(i > 45 & i <= 100){
                  if(i == 46){
                    // Remove fireball
                      fireball = document.getElementById('fireball');
                      dragon.removeChild(fireball);
                  }
              // Fly away to right of screen
              const x_movement = (i - 15)*1.5;
              dragon.style.left = drag_pos_i + x_movement + '%';
              i++;
              // Gradually reduce opacity of burn marks on castle
              if(i == 80) {
                burned_bits_container = document.getElementById('burned-bits-container');
                burned_bits_container.style.opacity = 0.5;
                burned_bits_container.style.mixBlendMode = 'multiply';
              }
              if(i == 90) {
                burned_bits_container.style.opacity = 0.25;
                burned_bits_container.style.mixBlendMode = 'multiply';
              }
              if(i == 100){
                // Reset!
                guard_1.classList.remove('scared');
                guard_2.classList.remove('scared');
                castle.removeChild(burned_bits_container);
                dragon.style.left = drag_pos_i + '%';
              }
          }
          }
          }
      } else {
          clearInterval(interval);
      }
      }, 100); // Adjust the delay (in milliseconds) between each movement
      guard_1.classList.remove('scared');
      guard_2.classList.remove('scared');
  }

    // Define function to add burn markings to castle
    function add_burn_marks(){

        burn_marks = Array.from(['url(shinycastle/textures/flame_char_1.png)',
'url(shinycastle/textures/flame_char_2.png)',
'url(shinycastle/textures/flame_char_3.png)']);

        burned_bits_container = document.createElement('div');
        burned_bits_container.id = 'burned-bits-container';
        burned_bits_container.style.position = 'absolute';
        burned_bits_container.style.top = '-20%';
        burned_bits_container.style.width = '100%';
        burned_bits_container.style.left = '0';
        burned_bits_container.style.height = '150%';
        burned_bits_container.style.overflow = 'hidden';
        burned_bits_container.style.clipPath = 'polygon(0 0, 30% 0, 30% 40%, 50% 40%, 50% 0, 100% 0, 100% 100%, 0 100%)';

        castle = document.getElementById('castle');
        castle.appendChild(burned_bits_container);

        for(let i = 1; i<= 5; i++){
          burned_bits = document.createElement('div');

          rando_y = Number.parseInt(Math.random() * 40);
          rando_x = Number.parseInt(Math.random() * 40);
          size = Number.parseInt(Math.random() * 10);
          rotation = Number.parseInt(Math.random() * 360);
          the_opac = Number.parseInt(Math.random() * 100) / 100;
          the_width = 100 * size + 'px';
          the_height = 100 * size + 'px';
          the_decal_number = Math.floor(Math.random() * 3);
          the_decal = burn_marks[the_decal_number];

          burned_bits.style.position = 'absolute';
          burned_bits.style.left = rando_x + '%';
          burned_bits.style.top = rando_y + '%';
          burned_bits.style.width = the_width;
          burned_bits.style.height = the_height;
          burned_bits.style.rotate = rotation + 'deg';
          burned_bits.style.opacity = the_opac;
          burned_bits.style.backgroundImage = the_decal;

          burned_bits.classList.add('burned');
          burned_bits_container.appendChild(burned_bits);
        }
    }

    Shiny.addCustomMessageHandler('start_dragon_flight', function(data) {
       eval(data.message)
    });

</script>
</body>
</html>
